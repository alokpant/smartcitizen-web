!function(){"use strict";angular.module("app.components",["oauth","leaflet-directive"])}(),function(){"use strict";function t(){function t(t){var i={kitName:t.name,kitType:o(t),kitLastTime:moment(t.updated_at).fromNow(),kitLocation:e(t),kitLabels:n(t),kitClass:a(o(t))};return i}function e(t){var e="",n=t.data.location.city,o=t.data.location.country;return n&&(e+=n),o&&(e+=", "+o),e}function n(t){return{status:t.status,exposure:t.data.location.exposure}}function o(t){var e;return new RegExp("sck","i").test(t.kit.name)&&(e="SmartCitizen Kit"),e}function a(t){return t?t.toLowerCase().split(" ").join("_"):""}var i={parseKit:t};return i}angular.module("app.components").factory("utils",t)}(),function(){"use strict";function t(){return{scope:!1,restrict:"E",controller:"SignupController",controllerAs:"vm",templateUrl:"app/components/signup/signup.html"}}angular.module("app.components").directive("signup",t)}(),function(){"use strict";function t(t,e,n,o,a){function i(){e.show({hasBackdrop:!0,controller:"DialogController",templateUrl:"app/components/signup/signupModal.html",clickOutsideToClose:!0}).then(function(){})["finally"](function(){})}function s(t){n.post(t).then(function(){a.success("Signup was successful")})["catch"](function(t){console.log("err",t.data.errors)})}var c=this;c.showSignup=i,c.signup=s,c.errors={}}angular.module("app.components").controller("SignupController",t),t.$inject=["$scope","$mdDialog","user","animation","alert"]}(),function(){"use strict";function t(){function t(){}return{link:t,scope:!0,restrict:"E",templateUrl:"app/components/search/search.html",controller:"SearchController",controllerAs:"vm"}}angular.module("app.components").directive("search",t)}(),function(){"use strict";function t(t,e){function n(){}function o(){}function a(t){return e.globalSearch(t).then(function(t){return 0===t.length?(angular.element(document.body).css("overflow","auto"),t):(angular.element(document.body).css("overflow","hidden"),t.map(function(t){if("Location"!==t.type){var e=i(t),n=s(t);return{type:t.type,name:n,location:e,image:"User"===t.type?"http://fablabbcn.github.io/smartcitizen-web/assets/images/avatar.svg":"http://fablabbcn.github.io/smartcitizen-web/assets/images/kit.svg"}}}))})}function i(t){var e="";return t.city&&(e+=t.city),t.country&&(e+=", "+t.country),e}function s(t){var e="User"===t.type?t.username:t.name;return e?e:"No name"}var c=this;c.searchTextChange=n,c.selectedItemChange=o,c.querySearch=a,c.isIconWhite=!0,t.$on("removeNav",function(){t.$apply(function(){c.isIconWhite=!1})}),t.$on("addNav",function(){t.$apply(function(){c.isIconWhite=!0})})}angular.module("app.components").controller("SearchController",t),t.$inject=["$scope","search"]}(),function(){"use strict";function t(){function t(){}return{link:t,scope:!0,restrict:"E",templateUrl:"app/components/navbar/navbar.html",controller:"NavbarController",controllerAs:"vm"}}angular.module("app.components").directive("navbar",t)}(),function(){"use strict";function t(t){t.isShown=!0,t.$on("removeNav",function(){t.$apply(function(){t.isShown=!1})}),t.$on("addNav",function(){t.$apply(function(){t.isShown=!0})})}angular.module("app.components").controller("NavbarController",t),t.$inject=["$scope"]}(),function(){"use strict";angular.module("app.components")}(),function(){"use strict";function t(t,e,n,o,a,i,s){function c(t){return t.map(function(t){return r(t,!1)})}function r(t){return t.icon="offline"===t.status?m.icons.smartCitizenOffline:m.icons.smartCitizenOnline,t}function l(){var t={defaultIcon:{},smartCitizenNormal:{type:"div",className:"marker_normal",iconSize:[12,12]},smartCitizenOnline:{type:"div",className:"marker_online",iconSize:[12,12]},smartCitizenOffline:{type:"div",className:"marker_offline",iconSize:[12,12]}};return t}function u(t){return t}var m=this,p=u(a[0]);m.icons=l(),m.tiles={url:"https://a.tiles.mapbox.com/v4/tomasdiez.jnbhcnb2/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidG9tYXNkaWV6IiwiYSI6ImRTd01HSGsifQ.loQdtLNQ8GJkJl2LUzzxVg"},m.center={lat:p.lat,lng:p.lng,zoom:12},m.markers=c(a),m.currentMarker=s.getCurrentMarker(),m.defaults={scrollWheelZoom:!1},m.events={map:{enable:["dragend","zoomend","moveend","popupopen","popupclose","mousedown","dblclick","click","touchstart"],logic:"broadcast"}},t.$on("leafletDirectiveMap.popupopen",function(t,n){m.center={lat:n.leafletEvent.popup._latlng.lat,lng:n.leafletEvent.popup._latlng.lng,zoom:n.model.center.zoom};var o=n.leafletEvent.popup._source.options.myData.id;e.go("home.kit",{id:o})})}angular.module("app.components").controller("MapController",t),t.$inject=["$scope","$state","$timeout","location","initialMarkers","device","marker"]}(),function(){"use strict";function t(){}angular.module("app.components").controller("KitController",t)}(),function(){"use strict";function t(){}angular.module("app.components").controller("HomeController",t)}(),function(){"use strict";function t(t,e,n,o){t.answer=function(a){n.post(a).then(function(t){console.log("data",t),o.success("Signup was successful"),e.hide()})["catch"](function(e){console.log("err",e.data.errors),t.errors=e.data.errors})},t.hide=function(){e.hide()},t.cancel=function(){e.cancel()}}angular.module("app.components").controller("DialogController",t),t.$inject=["$scope","$mdDialog","user","alert"]}(),function(){"use strict";function t(t){return t.all("users")}angular.module("app.components").factory("user",t),t.$inject=["Restangular"]}(),function(){"use strict";function t(t,e){function n(t){return e.all("search").getList({q:t})}var o={globalSearch:n};return o}angular.module("app.components").factory("search",t),t.$inject=["$http","Restangular"]}(),function(){"use strict";function t(t){function e(t){a=t}function n(){return a}function o(){t.$broadcast("markerLoaded")}var a,i={setCurrentMarker:e,getCurrentMarker:n,dataLoaded:o};return i}angular.module("app.components").factory("marker",t),t.$inject=["$rootScope"]}(),function(){"use strict";function t(t){function e(){return o().success(function(t){var e=t.loc.split(",");return a={lat:parseFloat(e[0]),lng:parseFloat(e[1])}})}function n(){return a}function o(){return t.jsonp("http://ipinfo.io/?callback=JSON_CALLBACK")}var a;e();var i={getPosition:e,callAPI:o,getPositionObj:n};return i}angular.module("app.components").factory("geolocation",t),t.$inject=["$http"]}(),function(){"use strict";function t(t){function e(e){var n="";return n+=e.lat+","+e.lng,t.all("devices").getList({near:n})}function n(){return t.all("devices/world_map").getList()}function o(e){return t.one("devices",e).get()}var a={getDevices:e,getAllDevices:n,getDevice:o};return a}angular.module("app.components").factory("device",t),t.$inject=["Restangular"]}(),function(){"use strict";function t(t){function e(){n()}function n(){i=t.localStorage.getItem("smartcitizen.token")}function o(){return i}function a(){return!!i}var i=null;e();var s={isAuth:a,setCurrentUser:n,getCurrentUser:o};return s}angular.module("app.components").factory("auth",t),t.$inject=["$window"]}(),function(){"use strict";function t(){function t(t){n=t}function e(){return n}var n,o={setKit:t,getKit:e};return o}angular.module("app.components").factory("layout",t)}(),function(){"use strict";function t(t){function e(){t.$broadcast("blur")}function n(){t.$broadcast("unblur")}function o(){t.$broadcast("removeNav")}function a(){t.$broadcast("addNav")}var i={blur:e,unblur:n,removeNav:o,addNav:a};return i}angular.module("app.components").factory("animation",t),t.$inject=["$rootScope"]}(),function(){"use strict";function t(){function t(t,e){t.$watch("moveDown",function(t){t?e.addClass("move_down"):e.removeClass("move_down")})}return{link:t,scope:!1,restrict:"A"}}function e(t,e){function n(n,o){var a=o[0].offsetTop,i=angular.element(".stickNav").height();e(function(){a=o[0].offsetTop,i=angular.element(".stickNav").height()},1e3),angular.element(t).on("scroll",function(){var t=document.body.scrollTop;t+i>=a?(o.addClass("stickMenu"),n.$apply(function(){n.moveDown=!0})):(o.removeClass("stickMenu"),n.$apply(function(){n.moveDown=!1}))})}return{link:n,scope:!1,restrict:"A"}}function n(){function t(t,e){t.$on("blur",function(){e.addClass("blur")}),t.$on("unblur",function(){e.removeClass("blur")})}return{link:t,scope:!1,restrict:"A"}}function o(t){function e(e,n){n.on("focusin",function(){t.removeNav()}),n.on("focusout",function(){t.addNav()});var o=n.find("input");o.on("blur",function(){angular.element(document.body).css("overflow","auto")})}return{link:e}}function a(t,e,n){function o(e,o){{var a=t[0].body.clientHeight,i=angular.element(".stickNav").height();angular.element(".kit_overview").height(),angular.element(".kit_menu").height()}n(function(){var t=angular.element(".kit_overview").height(),e=angular.element(".kit_menu").height(),n=a-i-e-t;o.css("height",n+"px")})}return{link:o,scope:!0,restrict:"A"}}function i(t,e){function n(t,n){e(function(){var t=angular.element(".angular-leaflet-map").height(),e=angular.element(".stickNav").height();n.css("margin-top",t+e+"px")})}return{link:n}}angular.module("app.components").directive("moveDown",t).directive("stick",e).directive("blur",n).directive("focus",o).directive("changeMapHeight",a).directive("changeContentMargin",i),t.$inject=["layout"],e.$inject=["$window","$timeout"],o.$inject=["animation"],a.$inject=["$document","layout","$timeout"],i.$inject=["layout","$timeout"]}(),function(){"use strict";function t(t){function e(t){a("success",t)}function n(t){a("error",t)}function o(t){a("info",t)}function a(e,n,o){o=void 0===o?"top":o,t.show({controller:"AlertController",controllerAs:"vm",templateUrl:"app/components/alert/alert"+e+".html",hideDelay:1e4,position:o,locals:{message:n}})}var i={success:e,error:n,info:o};return i}angular.module("app.components").factory("alert",t),t.$inject=["$mdToast"]}(),function(){"use strict";function t(t,e){function n(){t.hide()}var o=this;o.close=n,o.message=e}angular.module("app.components").controller("AlertController",t),t.$inject=["$mdToast","message"]}(),function(){"use strict";angular.module("app.auth",[])}(),angular.module("app",["ngMaterial","ui.router","restangular","app.components","app.auth"]),function(){"use strict";function t(t,e,n,o){t.state("landing",{url:"/",resolve:{location:["geolocation",function(t){var e=t.getPositionObj();return e?e:t.callAPI().then(function(t){var e=t.data.loc.split(","),n={lat:parseFloat(e[0]),lng:parseFloat(e[1])};return n})}],initialMarkers:["$state","device","location",function(t,e,n){return e.getDevices(n).then(function(e){e=e.plain();var n=e[0];t.go("home.kit",{id:n.id})})}]}}).state("home",{url:"","abstract":!0,views:{"":{templateUrl:"app/components/home/template.html"},"map@home":{templateUrl:"app/components/map/map.html",controller:"MapController",controllerAs:"vm"}},resolve:{location:["geolocation",function(t){return t.callAPI().then(function(t){var e=t.data.loc.split(","),n={lat:parseFloat(e[0]),lng:parseFloat(e[1])};return n})}],initialMarkers:["$state","device","location","utils",function(t,e,n,o){return e.getDevices(n).then(function(t){t=t.plain();var e=t.map(function(t){var e=o.parseKit(t),n={lat:t.data.location.latitude,lng:t.data.location.longitude,message:'<div class="popup"><div class="popup_top '+e.kitClass+'"><p class="popup_name">'+e.kitName+'</p><p class="popup_type">'+e.kitType+'</p><p class="popup_time"><md-icon md-svg-src="http://fablabbcn.github.io/smartcitizen-web/assets/images/update_icon.svg"></md-icon>'+e.kitLastTime+'</p></div><div class="popup_bottom"><p class="popup_location"><md-icon md-svg-src="http://fablabbcn.github.io/smartcitizen-web/assets/images/location_icon.svg"></md-icon>'+e.kitLocation+'</p><div class="popup_labels"><span>'+e.kitLabels.status+"</span><span>"+e.kitLabels.exposure+"</span></div></div></div>",status:t.status,myData:{id:t.id}};return n});return e})}],initialPopup:["leafletData","initialMarkers",function(t,e){var n=e[0].myData.id;t.getMap().then(function(t){for(var e in t._layers)if(t._layers[e].options.myData){var o=t._layers[e].options.myData.id;o===n&&angular.element(t._layers[e]._icon).click()}})}]}}).state("home.kit",{url:"/kits/:id",views:{"container@home":{templateUrl:"app/components/kit/kit.html",controller:"KitController",controllerAs:"vm"}},resolve:{marker:["$stateParams","device","marker",function(t,e,n){e.getDevice(t.id).then(function(t){t=t.plain(),n.setCurrentMarker(t),n.dataLoaded()})}]}}),e.otherwise("/"),n.html5Mode({enabled:!0,requireBase:!1}).hashPrefix("!"),o.setBaseUrl("https://new-api.smartcitizen.me/v0")}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","RestangularProvider"]}(),angular.module("app").run(["$templateCache",function(t){t.put("app/components/alert/alerterror.html",'<md-toast class="red"><md-icon md-svg-src="http://fablabbcn.github.io/smartcitizen-web/assets/images/alert_icon.svg" alt="Insert Drive Icon" class="alert_icon"></md-icon><span flex="">{{ vm.message }}</span><md-button ng-click="vm.close()"><md-icon md-svg-src="http://fablabbcn.github.io/smartcitizen-web/assets/images/close_icon_black.svg" alt="Insert Drive Icon" class="close_icon"></md-icon></md-button></md-toast>'),t.put("app/components/alert/alertinfo.html",'<md-toast class="blue"><md-icon md-svg-src="http://fablabbcn.github.io/smartcitizen-web/assets/images/alert_icon.svg" alt="Insert Drive Icon" class="alert_icon"></md-icon><span flex="">{{ vm.message }}</span><md-button ng-click="vm.close()"><md-icon md-svg-src="http://fablabbcn.github.io/smartcitizen-web/assets/images/close_icon_black.svg" alt="Insert Drive Icon" class="close_icon"></md-icon></md-button></md-toast>'),t.put("app/components/alert/alertsuccess.html",'<md-toast class="green"><md-icon md-svg-src="http://fablabbcn.github.io/smartcitizen-web/assets/images/alert_icon.svg" alt="Insert Drive Icon" class="alert_icon"></md-icon><span flex="">{{ vm.message }}</span><md-button ng-click="vm.close()"><md-icon md-svg-src="http://fablabbcn.github.io/smartcitizen-web/assets/images/close_icon_black.svg" alt="Insert Drive Icon" class="close_icon"></md-icon></md-button></md-toast>'),t.put("app/components/home/home.html",'<div layout="vertical" layout-fill=""><md-content><section class="content"><section class="map"><h1>Here\'s the map</h1></section><section class="kit_data"><section class="kit_menu" layout="row" layout-align="center center" stick=""><p>Bar with kit info</p></section><section class="kit_fixed" move-down=""><section class="kit_overview" layout="row" layout-align="center center"><p>Kit data overview</p></section><section class="kit_detailed" layout="row" layout-align="center center"><section class="kit_dashboard"><p>Here it\'s the data</p></section></section></section></section></section></md-content></div>'),t.put("app/components/home/template.html",'<div layout="vertical" layout-fill=""><md-content><section class="content"><div ui-view="map" class="map_state"></div><div ui-view="container" class="kit"></div></section></md-content></div>'),t.put("app/components/kit/kit.html",'<section class="kit_data" change-content-margin=""><section class="kit_menu" layout="row" layout-align="center center" stick=""><p>Bar with kit info</p></section><section class="kit_fixed" move-down=""><section class="kit_overview" layout="row" layout-align="center center"><p>Kit data overview</p></section><section class="kit_detailed" layout="row" layout-align="center center"><section class="kit_dashboard"><p>Here it\'s the data</p></section></section></section></section>'),t.put("app/components/map/map.html",'<section class="map" change-map-height=""><leaflet center="vm.center" tiles="vm.tiles" markers="vm.markers" defaults="vm.defaults" event-broadcast="vm.events" width="100%" height="100%"></leaflet></section>'),t.put("app/components/navbar/navbar.html",'<md-toolbar layout="row" layout-align="end center" class="stickNav"><a href="/" class="logo_link"><md-icon md-svg-src="./assets/images/LogotipoSmartCitizen.svg" alt="Insert Drive Icon" class="logo_icon"></md-icon></a><section layout="row" class="nav_left" layout-align="space-around center"><md-button ng-show="isShown" href="#" class="md-flat full_height map"><md-icon md-svg-src="./assets/images/map_icon.svg" class="nav_icon"></md-icon><span>Map</span></md-button><md-button ng-show="isShown" href="#" class="md-flat full_height community"><md-icon md-svg-src="./assets/images/community_icon.svg" class="nav_icon"></md-icon><span>Community</span></md-button></section><search flex=""></search><section layout="row" class="nav_right" layout-align="space-around center"><md-button ng-show="isShown" href="#" class="md-flat full_height get">Get your Kit</md-button><md-button class="md-flat full_height log" ng-show="isShown">Log In</md-button><signup class="md-display-1" ng-show="isShown"></signup></section></md-toolbar>'),t.put("app/components/search/search.html",'<div class="search_icon"><md-icon md-svg-src="./assets/images/search_icon_white.svg" ng-show="vm.isIconWhite"></md-icon><md-icon md-svg-src="./assets/images/search_icon_black.svg" ng-show="!vm.isIconWhite"></md-icon></div><md-autocomplete md-selected-item="vm.selectedItem" md-selected-item-change="vm.selectedItemChange(item)" md-search-text="vm.searchText" md-search-text-change="vm.searchTextChange(vm.searchText)" md-items="item in vm.querySearch(vm.searchText)" md-item-text="" placeholder="Search" md-delay="400" focus=""><md-item-template><md-icon md-svg-src="{{ item.image }}" class="result_icon"></md-icon><span class="result_name">{{ item.name }}</span> <span class="result_location">{{ item.location }}</span></md-item-template></md-autocomplete>'),t.put("app/components/signup/signup.html",'<md-button ng-click="vm.showSignup($event)">Sign Up</md-button>'),t.put("app/components/signup/signupModal.html",'<md-dialog><md-dialog-content class="modal signup"><div><md-button class="close_icon"><md-icon md-svg-icon="http://fablabbcn.github.io/smartcitizen-web/assets/images/close_icon_blue.svg" ng-click="cancel()" class=""></md-icon></md-button><h2>SIGN UP</h2><div class="modal_message"><p>People looking for a better city</p><p>You\'re part of them? Feel free to join us!</p></div><div layout="" layout-sm="column" class="field"><md-input-container flex=""><label>Username</label> <input type="text" ng-model="vm.user.username"></md-input-container><p class="errors" ng-show="!!errors.username.length"><span ng-repeat="error in errors.username">Username {{ error }}<span ng-if="!$last">,</span></span></p></div><div layout="" layout-sm="column" class="field"><md-input-container flex=""><label>Password</label> <input type="password" ng-model="vm.user.password"></md-input-container><p class="errors" ng-show="!!errors.password.length"><span ng-repeat="error in errors.password">Password {{ error }}<span ng-if="!$last">,</span></span></p></div><div layout="" layout-sm="column" class="field"><md-input-container flex=""><label>Email</label> <input type="email" ng-model="vm.user.email"></md-input-container><p class="errors" ng-show="!!errors.email.length"><span ng-repeat="error in errors.email">Email {{ error }}<span ng-if="!$last">,</span></span></p></div></div><md-button class="md-raised md-primary main" ng-click="answer(vm.user)">Sign up</md-button></md-dialog-content><p class="message_below"><span class="message_below_question">Already have an account?</span><md-button class="message_below_link">LOG IN</md-button></p></md-dialog>')}]);